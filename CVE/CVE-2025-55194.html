<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CVE-2025-55194 – Persistent Denial of Service in Part-DB</title>
  <style>
    body {
      background-color: black;
      color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0 20px;
    }

    header {
      text-align: center;
      padding: 2rem 0;
    }

    h1 {
      font-size: 2.5em;
      margin-bottom: 0.5rem;
    }

    .tag {
      display: inline-block;
      background-color: #6e5494;
      color: white;
      font-size: 0.8em;
      padding: 4px 8px;
      border-radius: 4px;
      margin-bottom: 1rem;
    }

        small {
  color: #aaa;
  font-family: monospace;
} 


    article {
      max-width: 800px;
      margin: auto;
      line-height: 1.6;
    }

    h2 {
      color: #6e5494;
      margin-top: 2rem;
    }

    a {
      color: #6e5494;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    pre {
      background-color: #1e1e1e;
      padding: 1rem;
      overflow-x: auto;
      border-radius: 6px;
      border: 1px solid #555;
    }

    code {
      font-family: monospace;
      color: #9cdcfe;
    }

    footer {
      text-align: center;
      margin-top: 3rem;
      font-size: 0.8em;
      color: white;
    }

    footer a {
      color: white;
    }

    footer a:hover {
      color: #6e5494;
    }
  </style>
</head>
<body>

<header>
  <h1>CVE-2025-55194</h1>
  <div class="tag">Persistent Denial of Service</div>
  <p><em>Uncaught Exception from Misleading File Extension in Avatar Upload in Part-DB &le; 1.17.2</em></p>
</header>

<article>
  <h2>Overview</h2>
  <p>A vulnerability in Part-DB 1.17.2 allows any authenticated user to upload a profile picture with a misleading file extension (e.g., <code>.jpg.txt</code>), resulting in a persistent <strong>500 Internal Server Error</strong> when accessing that user’s profile. This effectively locks the affected profile in the UI for both users and administrators, constituting a Denial of Service.</p>

  <h2>Affected Versions</h2>
  <ul>
    <li>Part-DB &le; 1.17.2</li>
  </ul>

  <h2>Patched Versions</h2>
  <ul>
    <li>Part-DB &ge; 1.17.3</li>
  </ul>

  <h2>Technical Details</h2>
  <p>The issue is in <code>src/Services/Attachments/AttachmentURLGenerator.php</code>, specifically the <code>getThumbnailURL()</code> method. It assumes uploaded files are valid images based solely on their extension. If a file has a valid image binary but a misleading extension (like <code>.jpg.txt</code>), the function throws an uncaught <code>InvalidArgumentException</code>:</p>
  
  <pre><code>if (!$attachment->isPicture()) {
    throw new InvalidArgumentException('Thumbnail creation only works for picture attachments!');
}</code></pre>
  
<p>This method is invoked when rendering user profiles in <code>templates/admin/user_admin.html.twig</code>:</p>
<pre><code>{% block preview_picture %}
    &lt;img src=&quot;{{ avatar_helper.avatarURL(entity) }}&quot; style=&quot;height: 50px;&quot;&gt;
{% endblock %}</code></pre>

<!--
  <h2>PoC</h2>
  <ol>
    <li>Log in as a user with permissions to change their avatar (admin or standard user).</li>
    <li>Navigate to <code>/en/user/settings</code>.</li>
    <li>Upload a valid image file but rename it with a double extension, e.g., <code>avatar.jpg.txt</code>.</li>
    <li>Submit the form to save settings.</li>
    <li>Attempt to revisit the profile settings or access the user from the admin panel.</li>
    <li>Result: a persistent <strong>500 Internal Server Error</strong> occurs.</li>
  </ol>
-->
  <p>Steps to reproduce:</p>
  <pre><code>1. Log in as a user with permissions to change their avatar (admin or standard user).
2. Navigate to /en/user/settings.
3. Upload a valid image file but rename it with a double extension, e.g: avatar.jpg.txt
4. Submit the form to save settings.
5. Attempt to revisit the profile settings or access the user from the admin panel.
6. Result: a persistent <strong>500 Internal Server Error</strong> occurs.</code></pre>

  <p>Video PoC: <a href="https://drive.google.com/file/d/10exp_BS9kRKHrFSPjiA_ZYUVJbHN8doW/view" target="_blank">View PoC</a><small> - https://drive.google.com/file/d/10exp_BS9kRKHrFSPjiA_ZYUVJbHN8doW/view</small></p>

  <h2>Impact</h2>
  <ul>
    <li>Affected users cannot access their profile settings.</li>
    <li>Administrators cannot view, edit, or delete affected users from the admin panel.</li>
    <li>The broken state is persistent; manual intervention is required.</li>
    <li>No remote code execution, privilege escalation, or data leakage occurs, but core functionality is disrupted.</li>
  </ul>

  <h2>Solution</h2>
  <ul>
    <li>Upgrade to <strong>Part-DB 1.17.3</strong> or later.</li>
    <li>Direct patch: <a href="https://github.com/Part-DB/Part-DB-server/commit/d370f976a7b0c19d502aadbaa0f93eb90c2a6ffa" target="_blank">GitHub Commit Fix</a> <small> - https://github.com/Part-DB/Part-DB-server/commit/d370f976a7b0c19d502aadbaa0f93eb90c2a6ffa</small></li>
  </ul>

  <h2>Timeline</h2>
  <ul>
    <li>2025-08-06 – Vulnerability reported</li>
    <li>2025-08-12 – Patch committed</li>
    <li>2025-08-13 – CVE assigned (CVE-2025-55194)</li>
    <li>2025-08-13 – Advisory published</li>
  </ul>

  <h2>References</h2>
  <ul>
    <li><a href="https://github.com/Part-DB/Part-DB-server/commit/d370f976a7b0c19d502aadbaa0f93eb90c2a6ffa" target="_blank">Patch Commit on GitHub</a> <small> - https://github.com/Part-DB/Part-DB-server/commit/d370f976a7b0c19d502aadbaa0f93eb90c2a6ffa</small></li>
      <li><a href="https://github.com/Part-DB/Part-DB-server/security/advisories/GHSA-7rv3-rcxv-69ww">Part-DB Security Advisory</a> <small> - https://github.com/Part-DB/Part-DB-server/security/advisories/GHSA-7rv3-rcxv-69ww</small></li>  
  <li><a href="https://drive.google.com/file/d/10exp_BS9kRKHrFSPjiA_ZYUVJbHN8doW/view" target="_blank">PoC Video</a> <small> - https://drive.google.com/file/d/10exp_BS9kRKHrFSPjiA_ZYUVJbHN8doW/view</small></li>
  </ul>
</article>

<footer>
  <p>
    &copy; 2025 <a href="https://github.com/NaklehZeidan21" target="_blank">Nakleh Zeidan</a>
  </p>
</footer>

</body>
</html>
